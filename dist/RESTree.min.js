"use strict";if(!window.RESTree){window.RESTree=!0;var RESTree=function(){function a(a){return new b(a,null)}function b(a,b){this.location=a,this.parent=b,this.nodes=[],this.params=[],this.headers={},this.pipes={get:{out:[],"in":[]},post:{out:[],"in":[]},put:{out:[],"in":[]},"delete":{out:[],"in":[]}},this.extractParams()}function c(a,b){var c,d;for(d=[];a;)d.unshift(a),a=a.parent;for(;a=d.shift();){c=Object.keys(a.headers);for(var e=0,f=c.length,g=c[e];f>e;e++,g=c[e])b.setRequestHeader(g,a.headers[g])}}function d(a,b){this.node=a,this.parent=b}function e(a){return function(){return this.__proto__[a].branch(this)}}function f(a,b,c,d,e){var f,h,i;f=JSON.parse(b.target.responseText),h=b.target.status,h>=200&&300>h?(i=a.pipes[c]["in"],f=g(i,f),d&&d(h,f)):e&&e(h,f)}function g(a,b){if(!b)return void 0;for(var c=0,d=a.length;d>c;c++)b=a[c](b);return b}return b.prototype.paramRegex=/{([a-zA-Z][a-zA-Z0-9_]*)}/g,b.prototype.add=function(a,c){if(this.hasOwnProperty(a))throw new Error("The given name '"+a+"' is already registered on node '"+this.location+"'");return c=c||a,this[a]=new b(c,this),this.nodes.push(a),this},b.prototype.pipe=function(a,b,c){if(!this.pipes.hasOwnProperty(a))throw new Error("The given method name '"+a+"' does not exist, use 'get', 'post', 'put' or 'delete'.");if(!this.pipes[a].hasOwnProperty(b))throw new Error("The given line name '"+b+"' is not defined, use 'in', 'out' or 'error'");for(var d=0,e=c.length,f=c[d];e>d;d++,f=c[d])this.pipes[a][b].push(f)},b.prototype["in"]=function(a){for(var b=[],c=1,d=arguments.length;d>c;c++)b.push(arguments[c]);this.pipe(a,"in",b)},b.prototype.out=function(a){for(var b=[],c=1,d=arguments.length;d>c;c++)b.push(arguments[c]);this.pipe(a,"out",b)},b.prototype.header=function(a,b){this.headers[a]=b},b.prototype.extractParams=function(){for(var a;a=this.paramRegex.exec(this.location);)this.params.push(a[1])},b.prototype.localLocation=function(a){var b,c;b=this.location;for(var d=0,e=this.params.length;e>d;d++){var c;if(c=this.params[d],!a.hasOwnProperty(c))throw new Error("Missing property '"+c+"' on '"+this.location+"'.");b=b.replace(this.paramRegex,a[c])}return b},b.prototype.compile=function(){var a,b;if(this.parent)throw new Error("You may only use compile method on the root of RESTree.");a=new d(this,null),b=[];for(var c=0,e=this.nodes.length;e>c;c++){var f;f=this.nodes[c],b.push([this[f],a,f])}for(var g=b.length;g;g--){var h,i,j,f,k;h=b.shift(),i=h[0],j=h[1],f=h[2],k=new d(i,j),j[f]=k;for(var c=0,e=i.nodes.length;e>c;c++){var f;f=i.nodes[c],b.push([i[f],k,f])}g+=i.nodes.length}return a.branch(null)},d.prototype.branch=function(a){var b,c,d;b=Object.create(this),b.last=a,b.args=null,c=this.node.params.length?function(a){return this.args=a,this}.bind(b):b,d=b.node.nodes;for(var f=0,g=d.length;g>f;f++){var h;h=d[f],Object.defineProperty(b,h,{get:e(h),enumerable:!0})}return c},d.prototype.mount=function(a){var b,c,d,e;for(b=this.node.localLocation(this.args),c=this.last;c;c=c.last)b=c.node.localLocation(c.args)+"/"+b;if(a)for(d=Object.keys(a),e=d.shift(),b+="?"+e+"="+encodeURIComponent(a[e]);e=d.shift();)b+="&"+e+"="+encodeURIComponent(a[e]);return b},d.prototype.request=function(a,b,d,e,h){var i,j,k;j=this.mount(b),k=this.node.pipes[a].out,d=JSON.stringify(g(k,d)),i=new XMLHttpRequest,i.addEventListener("load",function(b){f(this.node,b,a,e,h)}.bind(this)),i.open(a,j),i.setRequestHeader("Content-type","application/json"),c(this.node,i),i.send(d)},d.prototype.get=function(a){return this.request("get",a.query,a.body,a.success,a.fail)},d.prototype.post=function(a,b,c,d){return this.request("post",properties.query,properties.body,properties.success,properties.fail)},d.prototype.put=function(a,b,c,d){return this.request("put",properties.query,properties.body,properties.success,properties.fail)},d.prototype["delete"]=function(a,b,c,d){return this.request("delete",properties.query,properties.body,properties.success,properties.fail)},a}()}